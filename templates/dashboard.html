<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Engine Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-robot"></i> AI Engine v3.0
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                <a class="nav-link" href="/providers"><i class="fas fa-server"></i> Providers</a>
                <a class="nav-link" href="/statistics"><i class="fas fa-chart-bar"></i> Statistics</a>
                <a class="nav-link" href="/models"><i class="fas fa-cubes"></i> Models</a>
                <a class="nav-link" href="/docs"><i class="fas fa-book"></i> API Docs</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <h1><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
                <p class="text-muted">Monitor your AI Engine performance and providers</p>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-check-circle"></i> Active Providers</h5>
                        <h2 id="activeProviders">-</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-server"></i> Total Providers</h5>
                        <h2 id="totalProviders">-</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-exclamation-triangle"></i> Flagged</h5>
                        <h2 id="flaggedProviders">-</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-clock"></i> Uptime</h5>
                        <h2 id="uptime">-</h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-pie"></i> Provider Status</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="providerStatusChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-key"></i> Key Usage Summary</h5>
                    </div>
                    <div class="card-body">
                        <div id="keyUsageSummary">
                            <p class="text-muted">Loading...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-list"></i> Recent Activity</h5>
                    </div>
                    <div class="card-body">
                        <div id="recentActivity">
                            <p class="text-muted">Loading recent activity...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let startTime = Date.now();

        async function updateDashboard() {
            try {
                const statusResponse = await fetch('/api/status');
                const status = await statusResponse.json();

                document.getElementById('activeProviders').textContent = status.available_providers;
                document.getElementById('totalProviders').textContent = status.total_providers;
                document.getElementById('flaggedProviders').textContent = status.flagged_providers;

                const uptime = Math.floor((Date.now() - startTime) / 1000 / 60);
                document.getElementById('uptime').textContent = uptime + 'm';

                // Update provider status chart
                updateProviderChart(status);

            } catch (error) {
                console.error('Error updating dashboard:', error);
            }
        }

        function updateProviderChart(status) {
            const ctx = document.getElementById('providerStatusChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Active', 'Flagged'],
                    datasets: [{
                        data: [status.available_providers, status.flagged_providers],
                        backgroundColor: ['#28a745', '#ffc107']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });
        }

        // Update dashboard every 30 seconds
        setInterval(updateDashboard, 30000);
        updateDashboard(); // Initial load
    </script>
</body>
</html>